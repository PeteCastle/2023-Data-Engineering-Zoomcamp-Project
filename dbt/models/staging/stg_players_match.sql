{{ config(materialized='view')}}
WITH temp_table AS (
    SELECT 
        row_number() OVER(PARTITION BY matchId,summonerName ORDER BY last_update) AS rownum, --This is to ensure that MATCHES will only receive the latest record
        matchId,
        allInPings,
        assistMePings,
        assists,
        baitPings,
        baronKills,
        basicPings,
        bountyLevel,
        champExperience,
        championId,
        -- championName, Will be keyed to championId instead
        championTransform,
        champLevel,
        commandPings,
        consumablesPurchased,
        damageDealtToBuildings,
        damageDealtToObjectives,
        damageDealtToTurrets,
        damageSelfMitigated,
        dangerPings,
        deaths,
        detectorWardsPlaced,
        doubleKills,
        dragonKills,
        eligibleForProgression,
        enemyMissingPings,
        enemyVisionPings,
        firstBloodAssist,
        firstBloodKill,
        firstTowerAssist,
        firstTowerKill,
        gameEndedInEarlySurrender,
        gameEndedInSurrender,
        getBackPings,
        goldEarned,
        goldSpent,
        holdPings,
        individualPosition,
        inhibitorKills,
        inhibitorsLost,
        inhibitorTakedowns,
        item0,
        item1,
        item2,
        item3,
        item4,
        item5,
        item6,
        itemsPurchased,
        killingSprees,
        kills,
        lane,
        largestCriticalStrike,
        largestKillingSpree,
        largestMultiKill,
        -- last_update:timestamp
        longestTimeSpentLiving,
        magicDamageDealt,
        magicDamageDealtToChampions,
        magicDamageTaken,
        needVisionPings,
        neutralMinionsKilled,
        nexusKills,
        nexusLost,
        nexusTakedowns,
        objectivesStolen,
        objectivesStolenAssists,
        onMyWayPings,
        participantId,
        pentaKills,
        physicalDamageDealt,
        physicalDamageDealtToChampions,
        physicalDamageTaken,
        primaryStyle_0_id,
        primaryStyle_0_var1,
        primaryStyle_0_var2,
        primaryStyle_0_var3,
        primaryStyle_1_id,
        primaryStyle_1_var1,
        primaryStyle_1_var2,
        primaryStyle_1_var3,
        primaryStyle_2_id,
        primaryStyle_2_var1,
        primaryStyle_2_var2,
        primaryStyle_2_var3,
        primaryStyle_3_id,
        primaryStyle_3_var1,
        primaryStyle_3_var2,
        primaryStyle_3_var3,
        primaryStyle_id,
        profileIcon,
        pushPings,
        quadraKills,
        -- riotIdName,
        -- riotIdTagline,
        role,
        sightWardsBoughtInGame,
        spell1Casts,
        spell2Casts,
        spell3Casts,
        spell4Casts,
        statPerks_defense,
        statPerks_flex,
        statPerks_offense,
        subStyle_0_id,
        subStyle_0_var1,
        subStyle_0_var2,
        subStyle_0_var3,
        subStyle_1_id,
        subStyle_1_var1,
        subStyle_1_var2,
        subStyle_1_var3,
        subStyle_id,
        summoner1Casts,
        summoner1Id,
        summoner2Casts,
        summoner2Id,
        summonerLevel,
        summonerName,
        teamEarlySurrendered,
        teamId,
        teamPosition,
        timeCCingOthers,
        timePlayed,
        totalDamageDealt,
        totalDamageDealtToChampions,
        totalDamageShieldedOnTeammates,
        totalDamageTaken,
        totalHeal,
        totalHealsOnTeammates,
        totalMinionsKilled,
        totalTimeCCDealt,
        totalTimeSpentDead,
        totalUnitsHealed,
        tripleKills,
        trueDamageDealt,
        trueDamageDealtToChampions,
        trueDamageTaken,
        turretKills,
        turretsLost,
        turretTakedowns,
        unrealKills,
        visionClearedPings,
        visionScore,
        visionWardsBoughtInGame,
        wardsKilled,
        wardsPlaced,
        win
    FROM players_match
)
SELECT 
    matchId,
    allInPings,
    assistMePings,
    assists,
    baitPings,
    baronKills,
    basicPings,
    bountyLevel,
    champExperience,
    championId,
    -- championName, Will be keyed to championId instead
    championTransform,
    champLevel,
    commandPings,
    consumablesPurchased,
    damageDealtToBuildings,
    damageDealtToObjectives,
    damageDealtToTurrets,
    damageSelfMitigated,
    dangerPings,
    deaths,
    detectorWardsPlaced,
    doubleKills,
    dragonKills,
    eligibleForProgression,
    enemyMissingPings,
    enemyVisionPings,
    firstBloodAssist,
    firstBloodKill,
    firstTowerAssist,
    firstTowerKill,
    gameEndedInEarlySurrender,
    gameEndedInSurrender,
    getBackPings,
    goldEarned,
    goldSpent,
    holdPings,
    individualPosition,
    inhibitorKills,
    inhibitorsLost,
    inhibitorTakedowns,
    item0,
    item1,
    item2,
    item3,
    item4,
    item5,
    item6,
    itemsPurchased,
    killingSprees,
    kills,
    lane,
    largestCriticalStrike,
    largestKillingSpree,
    largestMultiKill,
    -- last_update:timestamp
    longestTimeSpentLiving,
    magicDamageDealt,
    magicDamageDealtToChampions,
    magicDamageTaken,
    needVisionPings,
    neutralMinionsKilled,
    nexusKills,
    nexusLost,
    nexusTakedowns,
    objectivesStolen,
    objectivesStolenAssists,
    onMyWayPings,
    participantId,
    pentaKills,
    physicalDamageDealt,
    physicalDamageDealtToChampions,
    physicalDamageTaken,
    primaryStyle_0_id,
    primaryStyle_0_var1,
    primaryStyle_0_var2,
    primaryStyle_0_var3,
    primaryStyle_1_id,
    primaryStyle_1_var1,
    primaryStyle_1_var2,
    primaryStyle_1_var3,
    primaryStyle_2_id,
    primaryStyle_2_var1,
    primaryStyle_2_var2,
    primaryStyle_2_var3,
    primaryStyle_3_id,
    primaryStyle_3_var1,
    primaryStyle_3_var2,
    primaryStyle_3_var3,
    primaryStyle_id,
    profileIcon,
    pushPings,
    quadraKills,
    -- riotIdName,
    -- riotIdTagline,
    role,
    sightWardsBoughtInGame,
    spell1Casts,
    spell2Casts,
    spell3Casts,
    spell4Casts,
    statPerks_defense,
    statPerks_flex,
    statPerks_offense,
    subStyle_0_id,
    subStyle_0_var1,
    subStyle_0_var2,
    subStyle_0_var3,
    subStyle_1_id,
    subStyle_1_var1,
    subStyle_1_var2,
    subStyle_1_var3,
    subStyle_id,
    summoner1Casts,
    summoner1Id,
    summoner2Casts,
    summoner2Id,
    summonerLevel,
    summonerName,
    teamEarlySurrendered,
    teamId,
    teamPosition,
    timeCCingOthers,
    timePlayed,
    totalDamageDealt,
    totalDamageDealtToChampions,
    totalDamageShieldedOnTeammates,
    totalDamageTaken,
    totalHeal,
    totalHealsOnTeammates,
    totalMinionsKilled,
    totalTimeCCDealt,
    totalTimeSpentDead,
    totalUnitsHealed,
    tripleKills,
    trueDamageDealt,
    trueDamageDealtToChampions,
    trueDamageTaken,
    turretKills,
    turretsLost,
    turretTakedowns,
    unrealKills,
    visionClearedPings,
    visionScore,
    visionWardsBoughtInGame,
    wardsKilled,
    wardsPlaced,
    win
FROM temp_table
WHERE rownum = 1